<!doctype html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd"><title></title><meta content="text/html; charset=utf-8"http-equiv=content-type><style>pre{line-height:125%}td.linenos .normal,span.linenos{color:inherit;background-color:#0000;padding-left:5px;padding-right:5px}td.linenos .special,span.linenos.special{color:#000;background-color:#ffffc0;padding-left:5px;padding-right:5px}body .hll{background-color:#ffc}body{background:#f8f8f8}body .c{color:#3d7b7b;font-style:italic}body .err{border:1px solid red}body .k{color:green;font-weight:700}body .o{color:#666}body .ch,body .cm{color:#3d7b7b;font-style:italic}body .cp{color:#9c6500}body .cpf,body .c1,body .cs{color:#3d7b7b;font-style:italic}body .gd{color:#a00000}body .ge{font-style:italic}body .ges{font-style:italic;font-weight:700}body .gr{color:#e40000}body .gh{color:navy;font-weight:700}body .gi{color:#008400}body .go{color:#717171}body .gp{color:navy;font-weight:700}body .gs{font-weight:700}body .gu{color:purple;font-weight:700}body .gt{color:#04d}body .kc,body .kd,body .kn{color:green;font-weight:700}body .kp{color:green}body .kr{color:green;font-weight:700}body .kt{color:#b00040}body .m{color:#666}body .s{color:#ba2121}body .na{color:#687822}body .nb{color:green}body .nc{color:#00f;font-weight:700}body .no{color:#800}body .nd{color:#a2f}body .ni{color:#717171;font-weight:700}body .ne{color:#cb3f38;font-weight:700}body .nf{color:#00f}body .nl{color:#767600}body .nn{color:#00f;font-weight:700}body .nt{color:green;font-weight:700}body .nv{color:#19177c}body .ow{color:#a2f;font-weight:700}body .w{color:#bbb}body .mb,body .mf,body .mh,body .mi,body .mo{color:#666}body .sa,body .sb,body .sc,body .dl{color:#ba2121}body .sd{color:#ba2121;font-style:italic}body .s2{color:#ba2121}body .se{color:#aa5d1f;font-weight:700}body .sh{color:#ba2121}body .si{color:#a45a77;font-weight:700}body .sx{color:green}body .sr{color:#a45a77}body .s1{color:#ba2121}body .ss{color:#19177c}body .bp{color:green}body .fm{color:#00f}body .vc,body .vg,body .vi,body .vm{color:#19177c}body .il{color:#666}</style><body><h2></h2><div class=highlight><pre><span></span><span class=sa>r</span><span class=sd>"""</span>
<span class=sd>We present the end results of an experiment as a table.</span>

<span class=sd>By default, end result tables have two parts. The first part renders</span>
<span class=sd>information for each instance-algorithm combination. For each instance, the</span>
<span class=sd>statistics are displayed for each algorithm, aggregated over all runs of the</span>
<span class=sd>algorithm on an instance. The second part then renders statistics for each</span>
<span class=sd>algorithm and aggregated over all runs on all instances.</span>

<span class=sd>For both parts, you can choose which statistics should be displayed. The</span>
<span class=sd>column headers will automatically be chosen and rendered appropriately. The</span>
<span class=sd>default data are equivalent to what we will use in our book:</span>

<span class=sd>1. Part 1: Algorithm-Instance statistics</span>
<span class=sd>    - `$\instance$`: the instance name</span>
<span class=sd>    - `$\lowerBound{\objf}$`: the lower bound of the objective value of the</span>
<span class=sd>      instance</span>
<span class=sd>    - `setup`: the name of the algorithm or algorithm setup</span>
<span class=sd>    - `best`: the best objective value reached by any run on that instance</span>
<span class=sd>    - `mean`: the arithmetic mean of the best objective values reached over</span>
<span class=sd>       all runs</span>
<span class=sd>    - `sd`: the standard deviation of the best objective values reached over</span>
<span class=sd>       all runs</span>
<span class=sd>    - `mean1`: the arithmetic mean of the best objective values reached over</span>
<span class=sd>       all runs, divided by the lower bound (or goal objective value)</span>
<span class=sd>    - `mean(FE/ms)`: the arithmetic mean of objective function evaluations</span>
<span class=sd>       performed per millisecond, over all runs</span>
<span class=sd>    - `mean(t)`: the arithmetic mean of the time in milliseconds when the last</span>
<span class=sd>      improving move of a run was applied, over all runs</span>

<span class=sd>2. Part 2: Algorithm Summary Statistics</span>
<span class=sd>    - `setup`: the name of the algorithm or algorithm setup</span>
<span class=sd>    - `best1`: the minimum of the best objective values reached divided by</span>
<span class=sd>      the lower bound (or goal objective value) over all runs</span>
<span class=sd>    - `gmean1`: the geometric mean of the best objective values reached</span>
<span class=sd>       divided by the lower bound (or goal objective value) over all runs</span>
<span class=sd>    - `worst1`: the maximum of the best objective values reached divided by</span>
<span class=sd>      the lower bound (or goal objective value) over all runs</span>
<span class=sd>    - `sd1`: the standard deviation of the best objective values reached</span>
<span class=sd>       divided by the lower bound (or goal objective value) over all runs</span>
<span class=sd>    - `gmean(FE/ms)`: the geometric mean of objective function evaluations</span>
<span class=sd>      performed per millisecond, over all runs</span>
<span class=sd>    - `gmean(t)`: the geometric mean of the time in milliseconds when the last</span>
<span class=sd>      improving move of a run was applied, over all runs</span>

<span class=sd>The best values of each category are always rendered in bold face.</span>
<span class=sd>Tables can be rendered in different formats, such as</span>
<span class=sd>:py:class:`~moptipy.utils.markdown.Markdown`,</span>
<span class=sd>:py:class:`~moptipy.utils.latex.LaTeX`, and</span>
<span class=sd>:py:class:`~moptipy.utils.html.HTML`.</span>
<span class=sd>"""</span>

<span class=kn>from</span><span class=w> </span><span class=nn>pycommons.io.temp</span><span class=w> </span><span class=kn>import</span> <span class=n>temp_dir</span>

<span class=kn>from</span><span class=w> </span><span class=nn>moptipy.algorithms.random_sampling</span><span class=w> </span><span class=kn>import</span> <span class=n>RandomSampling</span>
<span class=kn>from</span><span class=w> </span><span class=nn>moptipy.algorithms.so.hill_climber</span><span class=w> </span><span class=kn>import</span> <span class=n>HillClimber</span>
<span class=kn>from</span><span class=w> </span><span class=nn>moptipy.algorithms.so.rls</span><span class=w> </span><span class=kn>import</span> <span class=n>RLS</span>
<span class=kn>from</span><span class=w> </span><span class=nn>moptipy.api.execution</span><span class=w> </span><span class=kn>import</span> <span class=n>Execution</span>
<span class=kn>from</span><span class=w> </span><span class=nn>moptipy.api.experiment</span><span class=w> </span><span class=kn>import</span> <span class=n>run_experiment</span>
<span class=kn>from</span><span class=w> </span><span class=nn>moptipy.evaluation.end_results</span><span class=w> </span><span class=kn>import</span> <span class=n>from_logs</span>
<span class=kn>from</span><span class=w> </span><span class=nn>moptipy.evaluation.tabulate_end_results</span><span class=w> </span><span class=kn>import</span> <span class=n>tabulate_end_results</span>
<span class=kn>from</span><span class=w> </span><span class=nn>moptipy.examples.jssp.gantt_space</span><span class=w> </span><span class=kn>import</span> <span class=n>GanttSpace</span>
<span class=kn>from</span><span class=w> </span><span class=nn>moptipy.examples.jssp.instance</span><span class=w> </span><span class=kn>import</span> <span class=n>Instance</span>
<span class=kn>from</span><span class=w> </span><span class=nn>moptipy.examples.jssp.makespan</span><span class=w> </span><span class=kn>import</span> <span class=n>Makespan</span>
<span class=kn>from</span><span class=w> </span><span class=nn>moptipy.examples.jssp.ob_encoding</span><span class=w> </span><span class=kn>import</span> <span class=n>OperationBasedEncoding</span>
<span class=kn>from</span><span class=w> </span><span class=nn>moptipy.operators.permutations.op0_shuffle</span><span class=w> </span><span class=kn>import</span> <span class=n>Op0Shuffle</span>
<span class=kn>from</span><span class=w> </span><span class=nn>moptipy.operators.permutations.op1_swap2</span><span class=w> </span><span class=kn>import</span> <span class=n>Op1Swap2</span>
<span class=kn>from</span><span class=w> </span><span class=nn>moptipy.spaces.permutations</span><span class=w> </span><span class=kn>import</span> <span class=n>Permutations</span>
<span class=kn>from</span><span class=w> </span><span class=nn>moptipy.utils.html</span><span class=w> </span><span class=kn>import</span> <span class=n>HTML</span>
<span class=kn>from</span><span class=w> </span><span class=nn>moptipy.utils.latex</span><span class=w> </span><span class=kn>import</span> <span class=n>LaTeX</span>

<span class=c1># The three JSSP instances we want to try to solve:</span>
<span class=n>problems</span> <span class=o>=</span> <span class=p>[</span><span class=k>lambda</span><span class=p>:</span> <span class=n>Instance</span><span class=o>.</span><span class=n>from_resource</span><span class=p>(</span><span class=s2>"ft06"</span><span class=p>),</span>
            <span class=k>lambda</span><span class=p>:</span> <span class=n>Instance</span><span class=o>.</span><span class=n>from_resource</span><span class=p>(</span><span class=s2>"la24"</span><span class=p>),</span>
            <span class=k>lambda</span><span class=p>:</span> <span class=n>Instance</span><span class=o>.</span><span class=n>from_resource</span><span class=p>(</span><span class=s2>"dmu23"</span><span class=p>)]</span>


<span class=k>def</span><span class=w> </span><span class=nf>make_rls</span><span class=p>(</span><span class=n>problem</span><span class=p>:</span> <span class=n>Instance</span><span class=p>)</span> <span class=o>-></span> <span class=n>Execution</span><span class=p>:</span>
<span class=w>    </span><span class=sd>"""</span>
<span class=sd>    Create an RLS Execution.</span>

<span class=sd>    :param problem: the JSSP instance</span>
<span class=sd>    :returns: the execution</span>
<span class=sd>    """</span>
    <span class=n>ex</span> <span class=o>=</span> <span class=n>Execution</span><span class=p>()</span>  <span class=c1># create execution context</span>
    <span class=n>perms</span> <span class=o>=</span> <span class=n>Permutations</span><span class=o>.</span><span class=n>with_repetitions</span><span class=p>(</span>  <span class=c1># create search space as</span>
        <span class=n>problem</span><span class=o>.</span><span class=n>jobs</span><span class=p>,</span> <span class=n>problem</span><span class=o>.</span><span class=n>machines</span><span class=p>)</span>  <span class=c1># permutations with repetitions</span>
    <span class=n>ex</span><span class=o>.</span><span class=n>set_search_space</span><span class=p>(</span><span class=n>perms</span><span class=p>)</span>  <span class=c1># set search space</span>
    <span class=n>ex</span><span class=o>.</span><span class=n>set_encoding</span><span class=p>(</span><span class=n>OperationBasedEncoding</span><span class=p>(</span><span class=n>problem</span><span class=p>))</span>  <span class=c1># set encoding</span>
    <span class=n>ex</span><span class=o>.</span><span class=n>set_solution_space</span><span class=p>(</span><span class=n>GanttSpace</span><span class=p>(</span><span class=n>problem</span><span class=p>))</span>  <span class=c1># solution space: Gantt charts</span>
    <span class=n>ex</span><span class=o>.</span><span class=n>set_objective</span><span class=p>(</span><span class=n>Makespan</span><span class=p>(</span><span class=n>problem</span><span class=p>))</span>  <span class=c1># objective function is makespan</span>
    <span class=n>ex</span><span class=o>.</span><span class=n>set_algorithm</span><span class=p>(</span><span class=n>RLS</span><span class=p>(</span>  <span class=c1># create RLS that</span>
        <span class=n>Op0Shuffle</span><span class=p>(</span><span class=n>perms</span><span class=p>),</span>  <span class=c1># create random permutation</span>
        <span class=n>Op1Swap2</span><span class=p>()))</span>  <span class=c1># swap two jobs</span>
    <span class=n>ex</span><span class=o>.</span><span class=n>set_max_time_millis</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span>  <span class=c1># permit 10 ms of runtime</span>
    <span class=k>return</span> <span class=n>ex</span>


<span class=k>def</span><span class=w> </span><span class=nf>make_hill_climber</span><span class=p>(</span><span class=n>problem</span><span class=p>:</span> <span class=n>Instance</span><span class=p>)</span> <span class=o>-></span> <span class=n>Execution</span><span class=p>:</span>
<span class=w>    </span><span class=sd>"""</span>
<span class=sd>    Create a hill climber Execution.</span>

<span class=sd>    :param problem: the JSSP instance</span>
<span class=sd>    :returns: the execution</span>
<span class=sd>    """</span>
    <span class=n>ex</span> <span class=o>=</span> <span class=n>Execution</span><span class=p>()</span>  <span class=c1># create execution context</span>
    <span class=n>perms</span> <span class=o>=</span> <span class=n>Permutations</span><span class=o>.</span><span class=n>with_repetitions</span><span class=p>(</span>  <span class=c1># create search space as</span>
        <span class=n>problem</span><span class=o>.</span><span class=n>jobs</span><span class=p>,</span> <span class=n>problem</span><span class=o>.</span><span class=n>machines</span><span class=p>)</span>  <span class=c1># permutations with repetitions</span>
    <span class=n>ex</span><span class=o>.</span><span class=n>set_search_space</span><span class=p>(</span><span class=n>perms</span><span class=p>)</span>  <span class=c1># set search space</span>
    <span class=n>ex</span><span class=o>.</span><span class=n>set_encoding</span><span class=p>(</span><span class=n>OperationBasedEncoding</span><span class=p>(</span><span class=n>problem</span><span class=p>))</span>  <span class=c1># set encoding</span>
    <span class=n>ex</span><span class=o>.</span><span class=n>set_solution_space</span><span class=p>(</span><span class=n>GanttSpace</span><span class=p>(</span><span class=n>problem</span><span class=p>))</span>  <span class=c1># solution space: Gantt charts</span>
    <span class=n>ex</span><span class=o>.</span><span class=n>set_objective</span><span class=p>(</span><span class=n>Makespan</span><span class=p>(</span><span class=n>problem</span><span class=p>))</span>  <span class=c1># objective function is makespan</span>
    <span class=n>ex</span><span class=o>.</span><span class=n>set_algorithm</span><span class=p>(</span>  <span class=c1># now construct algorithm</span>
        <span class=n>HillClimber</span><span class=p>(</span>  <span class=c1># create hill climber that</span>
            <span class=n>Op0Shuffle</span><span class=p>(</span><span class=n>perms</span><span class=p>),</span>  <span class=c1># create random permutation</span>
            <span class=n>Op1Swap2</span><span class=p>()))</span>  <span class=c1># swap two jobs</span>
    <span class=n>ex</span><span class=o>.</span><span class=n>set_max_time_millis</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span>  <span class=c1># permit 10 ms of runtime</span>
    <span class=k>return</span> <span class=n>ex</span>


<span class=k>def</span><span class=w> </span><span class=nf>make_random_sampling</span><span class=p>(</span><span class=n>problem</span><span class=p>:</span> <span class=n>Instance</span><span class=p>)</span> <span class=o>-></span> <span class=n>Execution</span><span class=p>:</span>
<span class=w>    </span><span class=sd>"""</span>
<span class=sd>    Create a random sampling Execution.</span>

<span class=sd>    :param problem: the JSSP instance</span>
<span class=sd>    :returns: the execution</span>
<span class=sd>    """</span>
    <span class=n>ex</span> <span class=o>=</span> <span class=n>Execution</span><span class=p>()</span>  <span class=c1># create execution context</span>
    <span class=n>perms</span> <span class=o>=</span> <span class=n>Permutations</span><span class=o>.</span><span class=n>with_repetitions</span><span class=p>(</span>  <span class=c1># create search space as</span>
        <span class=n>problem</span><span class=o>.</span><span class=n>jobs</span><span class=p>,</span> <span class=n>problem</span><span class=o>.</span><span class=n>machines</span><span class=p>)</span>  <span class=c1># permutations with repetitions</span>
    <span class=n>ex</span><span class=o>.</span><span class=n>set_search_space</span><span class=p>(</span><span class=n>perms</span><span class=p>)</span>  <span class=c1># set search space</span>
    <span class=n>ex</span><span class=o>.</span><span class=n>set_encoding</span><span class=p>(</span><span class=n>OperationBasedEncoding</span><span class=p>(</span><span class=n>problem</span><span class=p>))</span>  <span class=c1># set encoding</span>
    <span class=n>ex</span><span class=o>.</span><span class=n>set_solution_space</span><span class=p>(</span><span class=n>GanttSpace</span><span class=p>(</span><span class=n>problem</span><span class=p>))</span>  <span class=c1># solution space: Gantt charts</span>
    <span class=n>ex</span><span class=o>.</span><span class=n>set_objective</span><span class=p>(</span><span class=n>Makespan</span><span class=p>(</span><span class=n>problem</span><span class=p>))</span>  <span class=c1># objective function is makespan</span>
    <span class=n>ex</span><span class=o>.</span><span class=n>set_algorithm</span><span class=p>(</span>  <span class=c1># now construct algorithm</span>
        <span class=n>RandomSampling</span><span class=p>(</span>  <span class=c1># create hill climber that</span>
            <span class=n>Op0Shuffle</span><span class=p>(</span><span class=n>perms</span><span class=p>)))</span>  <span class=c1># create random permutation</span>
    <span class=n>ex</span><span class=o>.</span><span class=n>set_max_time_millis</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span>  <span class=c1># permit 10 ms of runtime</span>
    <span class=k>return</span> <span class=n>ex</span>


<span class=c1># We execute the whole experiment in a temp directory.</span>
<span class=c1># For a real experiment, you would put an existing directory path into `td` by</span>
<span class=c1># doing `from pycommons.io.path import Path; td = Path("mydir")` and not use</span>
<span class=c1># the `with` block.</span>
<span class=k>with</span> <span class=n>temp_dir</span><span class=p>()</span> <span class=k>as</span> <span class=n>td</span><span class=p>:</span>  <span class=c1># create temporary directory `td`</span>
    <span class=n>run_experiment</span><span class=p>(</span><span class=n>base_dir</span><span class=o>=</span><span class=n>td</span><span class=p>,</span>  <span class=c1># set the base directory for log files</span>
                   <span class=n>instances</span><span class=o>=</span><span class=n>problems</span><span class=p>,</span>  <span class=c1># define the problem instances</span>
                   <span class=n>setups</span><span class=o>=</span><span class=p>[</span><span class=n>make_rls</span><span class=p>,</span>  <span class=c1># provide RLS run creator</span>
                           <span class=n>make_hill_climber</span><span class=p>,</span>  <span class=c1># provide hill climber</span>
                           <span class=n>make_random_sampling</span><span class=p>],</span>  <span class=c1># provide random sampling</span>
                   <span class=n>n_runs</span><span class=o>=</span><span class=mi>7</span><span class=p>)</span>  <span class=c1># we will execute 31 runs per setup</span>
    <span class=c1># Once we arrived here, the experiment with 3*3*7=63 runs has completed.</span>

    <span class=n>data</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>from_logs</span><span class=p>(</span><span class=n>td</span><span class=p>))</span>  <span class=c1># we will load the data into this list</span>

    <span class=n>file</span> <span class=o>=</span> <span class=n>tabulate_end_results</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>dir_name</span><span class=o>=</span><span class=n>td</span><span class=p>)</span>  <span class=c1># create the table</span>
    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>"</span><span class=se>\n</span><span class=s2>now presenting markdown data from file </span><span class=si>{</span><span class=n>file</span><span class=si>!r}</span><span class=s2>.</span><span class=se>\n</span><span class=s2>"</span><span class=p>)</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>file</span><span class=o>.</span><span class=n>read_all_str</span><span class=p>())</span>  <span class=c1># print the result</span>

    <span class=n>file</span> <span class=o>=</span> <span class=n>tabulate_end_results</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>dir_name</span><span class=o>=</span><span class=n>td</span><span class=p>,</span>
                                <span class=n>text_format_driver</span><span class=o>=</span><span class=n>LaTeX</span><span class=o>.</span><span class=n>instance</span><span class=p>)</span>
    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>"</span><span class=se>\n</span><span class=s2>now presenting LaTeX data from file </span><span class=si>{</span><span class=n>file</span><span class=si>!r}</span><span class=s2>.</span><span class=se>\n</span><span class=s2>"</span><span class=p>)</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>file</span><span class=o>.</span><span class=n>read_all_str</span><span class=p>())</span>  <span class=c1># print the result</span>

    <span class=n>file</span> <span class=o>=</span> <span class=n>tabulate_end_results</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>dir_name</span><span class=o>=</span><span class=n>td</span><span class=p>,</span>
                                <span class=n>text_format_driver</span><span class=o>=</span><span class=n>HTML</span><span class=o>.</span><span class=n>instance</span><span class=p>)</span>
    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>"</span><span class=se>\n</span><span class=s2>now presenting HTML data from file </span><span class=si>{</span><span class=n>file</span><span class=si>!r}</span><span class=s2>.</span><span class=se>\n</span><span class=s2>"</span><span class=p>)</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>file</span><span class=o>.</span><span class=n>read_all_str</span><span class=p>())</span>  <span class=c1># print the result</span>

<span class=c1># The temp directory is deleted as soon as we leave the `with` block.</span>
<span class=c1># This means that all log files and the table file have disappeared.</span>
</pre></div>
