<!doctype html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd"><title></title><meta content="text/html; charset=utf-8"http-equiv=content-type><style>pre{line-height:125%}td.linenos .normal,span.linenos{color:inherit;background-color:#0000;padding-left:5px;padding-right:5px}td.linenos .special,span.linenos.special{color:#000;background-color:#ffffc0;padding-left:5px;padding-right:5px}body .hll{background-color:#ffc}body{background:#f8f8f8}body .c{color:#3d7b7b;font-style:italic}body .err{border:1px solid red}body .k{color:green;font-weight:700}body .o{color:#666}body .ch,body .cm{color:#3d7b7b;font-style:italic}body .cp{color:#9c6500}body .cpf,body .c1,body .cs{color:#3d7b7b;font-style:italic}body .gd{color:#a00000}body .ge{font-style:italic}body .ges{font-style:italic;font-weight:700}body .gr{color:#e40000}body .gh{color:navy;font-weight:700}body .gi{color:#008400}body .go{color:#717171}body .gp{color:navy;font-weight:700}body .gs{font-weight:700}body .gu{color:purple;font-weight:700}body .gt{color:#04d}body .kc,body .kd,body .kn{color:green;font-weight:700}body .kp{color:green}body .kr{color:green;font-weight:700}body .kt{color:#b00040}body .m{color:#666}body .s{color:#ba2121}body .na{color:#687822}body .nb{color:green}body .nc{color:#00f;font-weight:700}body .no{color:#800}body .nd{color:#a2f}body .ni{color:#717171;font-weight:700}body .ne{color:#cb3f38;font-weight:700}body .nf{color:#00f}body .nl{color:#767600}body .nn{color:#00f;font-weight:700}body .nt{color:green;font-weight:700}body .nv{color:#19177c}body .ow{color:#a2f;font-weight:700}body .w{color:#bbb}body .mb,body .mf,body .mh,body .mi,body .mo{color:#666}body .sa,body .sb,body .sc,body .dl{color:#ba2121}body .sd{color:#ba2121;font-style:italic}body .s2{color:#ba2121}body .se{color:#aa5d1f;font-weight:700}body .sh{color:#ba2121}body .si{color:#a45a77;font-weight:700}body .sx{color:green}body .sr{color:#a45a77}body .s1{color:#ba2121}body .ss{color:#19177c}body .bp{color:green}body .fm{color:#00f}body .vc,body .vg,body .vi,body .vm{color:#19177c}body .il{color:#666}</style><body><h2></h2><div class=highlight><pre><span></span><span class=sd>"""Get an end-result statistics CSV file for an experiment with the JSSP."""</span>
<span class=kn>from</span><span class=w> </span><span class=nn>pycommons.io.temp</span><span class=w> </span><span class=kn>import</span> <span class=n>temp_dir</span>  <span class=c1># tool for temp directories</span>

<span class=kn>from</span><span class=w> </span><span class=nn>moptipy.algorithms.so.hill_climber</span><span class=w> </span><span class=kn>import</span> <span class=n>HillClimber</span>  <span class=c1># second algo</span>
<span class=kn>from</span><span class=w> </span><span class=nn>moptipy.algorithms.so.rls</span><span class=w> </span><span class=kn>import</span> <span class=n>RLS</span>  <span class=c1># first algo to test</span>
<span class=kn>from</span><span class=w> </span><span class=nn>moptipy.evaluation.end_results</span><span class=w> </span><span class=kn>import</span> <span class=n>from_logs</span>  <span class=c1># the end result record</span>
<span class=kn>from</span><span class=w> </span><span class=nn>moptipy.evaluation.end_statistics</span><span class=w> </span><span class=kn>import</span> <span class=n>from_end_results</span><span class=p>,</span> <span class=n>to_csv</span>
<span class=kn>from</span><span class=w> </span><span class=nn>moptipy.examples.jssp.experiment</span><span class=w> </span><span class=kn>import</span> <span class=n>run_experiment</span>  <span class=c1># JSSP example</span>
<span class=kn>from</span><span class=w> </span><span class=nn>moptipy.operators.permutations.op0_shuffle</span><span class=w> </span><span class=kn>import</span> <span class=n>Op0Shuffle</span>  <span class=c1># 0-ary op</span>
<span class=kn>from</span><span class=w> </span><span class=nn>moptipy.operators.permutations.op1_swap2</span><span class=w> </span><span class=kn>import</span> <span class=n>Op1Swap2</span>  <span class=c1># 1-ary op</span>

<span class=c1># We work in a temporary directory, i.e., delete all generated files on exit.</span>
<span class=c1># For a real experiment, you would put an existing directory path into `td` by</span>
<span class=c1># doing `from pycommons.io.path import Path; td = Path("mydir")` and not use</span>
<span class=c1># the `with` block.</span>
<span class=k>with</span> <span class=n>temp_dir</span><span class=p>()</span> <span class=k>as</span> <span class=n>td</span><span class=p>:</span>
    <span class=n>run_experiment</span><span class=p>(</span>  <span class=c1># run the JSSP experiment with the following parameters:</span>
        <span class=n>base_dir</span><span class=o>=</span><span class=n>td</span><span class=p>,</span>  <span class=c1># base directory to write all log files to</span>
        <span class=n>algorithms</span><span class=o>=</span><span class=p>[</span>  <span class=c1># the set of algorithm generators</span>
            <span class=k>lambda</span> <span class=n>_</span><span class=p>,</span> <span class=n>pwr</span><span class=p>:</span> <span class=n>RLS</span><span class=p>(</span><span class=n>Op0Shuffle</span><span class=p>(</span><span class=n>pwr</span><span class=p>),</span> <span class=n>Op1Swap2</span><span class=p>()),</span>  <span class=c1># algo 1</span>
            <span class=k>lambda</span> <span class=n>_</span><span class=p>,</span> <span class=n>pwr</span><span class=p>:</span> <span class=n>HillClimber</span><span class=p>(</span><span class=n>Op0Shuffle</span><span class=p>(</span><span class=n>pwr</span><span class=p>),</span> <span class=n>Op1Swap2</span><span class=p>())],</span>  <span class=c1># 2</span>
        <span class=n>instances</span><span class=o>=</span><span class=p>(</span><span class=s2>"demo"</span><span class=p>,</span> <span class=s2>"abz7"</span><span class=p>,</span> <span class=s2>"la24"</span><span class=p>),</span>  <span class=c1># we use 3 JSSP instances</span>
        <span class=n>max_fes</span><span class=o>=</span><span class=mi>10000</span><span class=p>,</span>  <span class=c1># we grant 10000 FEs per run</span>
        <span class=n>n_runs</span><span class=o>=</span><span class=mi>4</span><span class=p>)</span>  <span class=c1># perform 4 runs per algorithm * instance combination</span>

    <span class=c1># Compute the end statistics from end results loaded from log files.</span>
    <span class=n>end_stats</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>from_end_results</span><span class=p>(</span><span class=n>from_logs</span><span class=p>(</span><span class=n>td</span><span class=p>)))</span>

    <span class=c1># store the statistics to a CSV file</span>
    <span class=n>es_csv</span> <span class=o>=</span> <span class=n>to_csv</span><span class=p>(</span><span class=n>end_stats</span><span class=p>,</span> <span class=n>td</span><span class=o>.</span><span class=n>resolve_inside</span><span class=p>(</span><span class=s2>"end_stats.txt"</span><span class=p>))</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>es_csv</span><span class=o>.</span><span class=n>read_all_str</span><span class=p>())</span>  <span class=c1># read and print the file</span>
<span class=c1># When leaving "while", the temp directory will be deleted</span>
</pre></div>
